<script src="https://cdn.jsdelivr.net/gh/netizenorg/netnet-standard-library/build/nn.min.js"></script>
<script>
  /* global nn */

  let GIF = 'https://generativeart.online/images/butterfly.gif'
  GIF = 'arrow.gif'
  const COLOR = 'plum'
  
  function createGif (x, y, w, h, deg, url) {
    nn.create('img')
      .set({ src: `${url}#${Math.random()}` })
      .css({
        position: 'absolute',
        width: w,
        height: h,
        transition: 'transform 2s',
        transform: `rotate(${deg}deg)`,
        left: x - w / 2,
        top: y - h / 2
      })
      .addTo('body')
  }
  
  
  function fOutput(x, num, denom) {
    return x === 0 ? num/denom : Math.sin(num*x) / (denom*x)
  }
  
  function fDeriv(x, num, denom) {
    if (x === 0) {
      return 0
    }
    let dNum = x * num * Math.cos(num*x) - Math.sin(num*x)
    let dDenom = denom * x * x
    return dNum/dDenom
  }
  
  async function createGifCircle (num, scale, radius, numerator, denominator, url) {
    console.log(fDeriv(2, 1, 1))
    const gif = await nn.loadImage(url)
    for (let i = 0; i < num; i++) {
      const cx = nn.width / 2
      const cy = nn.height / 2
      
      let xInput = -2 + (i / num) * 4
      let xDisplay = (i/num) * nn.width
      let y = cy + Math.cos(xInput * scale) * radius
      let eachDeriv = radius * xInput * scale * Math.sin(xInput * scale)
      // console.log(xInput, eachDeriv)
      let radianDeriv = Math.atan(eachDeriv)
      let angleDeriv = (radianDeriv / (2 * Math.PI)) * 360
      createGif(xDisplay, y, gif.width/20, gif.height/20, angleDeriv, url)
    }
  }
  
  function sleep (ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
  
  async function setup () {
    nn.get('body').css({
      backgroundColor: COLOR,
      overflow: 'hidden'
    })
    
    let halfAmount = 15
    for (let i = -1 * halfAmount; i<halfAmount*2; i+=2) {
      const images = document.getElementsByTagName('img');
      while (images.length > 0) {
        images[0].parentNode.removeChild(images[0]);
      }
      createGifCircle(400, Math.abs(i), 100, 1, 1, GIF)
      await sleep(1000)
    }
  }
  
  nn.on('load', setup)
  
</script>